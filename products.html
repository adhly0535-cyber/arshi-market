<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Arshi Market</title>

<style>
body{
  font-family: Arial;
  margin:0;
  padding-bottom:70px;
  background:#f5f5f5;
}

/* Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆÙ„Ø© */
.country-name{
  background:#4CAF50;
  color:#fff;
  text-align:center;
  padding:10px;
  font-weight:bold;
  cursor:pointer;
}

/* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© */
.state-box{
  background:#fff;
  padding:10px;
  text-align:center;
  border-bottom:1px solid #ddd;
}

.state-box select{
  padding:8px 14px;
  border-radius:20px;
  border:1px solid #ccc;
  background:#f0f0f0;
}

/* Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
.categories{
  display:flex;
  gap:8px;
  padding:10px;
  background:#fff;
  overflow-x:auto;
}

.categories button{
  border:none;
  background:#eee;
  padding:8px 14px;
  border-radius:20px;
  cursor:pointer;
  white-space:nowrap;
}

#addBtn{
  display:none;
  background:#4CAF50;
  color:#fff;
}

/* Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
.products{
  padding:10px;
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:10px;
}

.product-card{
  background:#fff;
  padding:6px;
  border-radius:10px;
  font-size:13px;
}
</style>
</head>

<body>

<div class="country-name" id="countryName"></div>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© (Ø«Ø§Ø¨Øª) -->
<div class="state-box">
  <select id="stateFilter">
    <option value="">ÙƒÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª</option>
  </select>
</div>

<div class="categories">
  <button onclick="selectCategory('Ø³ÙŠØ§Ø±Ø§Øª')">ğŸš— Ø³ÙŠØ§Ø±Ø§Øª</button>
  <button onclick="selectCategory('Ø¨ÙŠÙˆØª')">ğŸ  Ø¨ÙŠÙˆØª</button>
  <button onclick="selectCategory('Ù‡ÙˆØ§ØªÙ')">ğŸ“± Ù‡ÙˆØ§ØªÙ</button>
  <button onclick="selectCategory('Ø£Ø®Ø±Ù‰')">â• Ø£Ø®Ø±Ù‰</button>

  <button id="addBtn" onclick="goAddProduct()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
</div>

<div class="products" id="products"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyD3hAvhSDs-lX7ORCOR0DODT3l_S_gJA2o",
  authDomain: "arshi-market.firebaseapp.com",
  projectId: "arshi-market",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* Ø§Ù„Ø¯ÙˆÙ„Ø© */
const country = localStorage.getItem("country");
if(!country) location.href = "country.html";

const countryName = document.getElementById("countryName");
countryName.innerText = "ğŸ“ Ø§Ù„Ø¯ÙˆÙ„Ø©: " + country;
countryName.onclick = ()=> location.href="country.html";

/* Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© (Ø³ÙˆØ¯Ø§Ù† + Ù…ØµØ± ÙÙ‚Ø·) */
const statesByCountry = {
  "Ø§Ù„Ø³ÙˆØ¯Ø§Ù†": [
    "Ø§Ù„Ø®Ø±Ø·ÙˆÙ…","Ø§Ù„Ø¬Ø²ÙŠØ±Ø©","Ù†Ù‡Ø± Ø§Ù„Ù†ÙŠÙ„","Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±",
    "ÙƒØ³Ù„Ø§","Ø§Ù„Ù‚Ø¶Ø§Ø±Ù","Ø³Ù†Ø§Ø±","Ø§Ù„Ù†ÙŠÙ„ Ø§Ù„Ø£Ø¨ÙŠØ¶",
    "Ø´Ù…Ø§Ù„ ÙƒØ±Ø¯ÙØ§Ù†","Ø¬Ù†ÙˆØ¨ ÙƒØ±Ø¯ÙØ§Ù†",
    "Ø´Ù…Ø§Ù„ Ø¯Ø§Ø±ÙÙˆØ±","Ø¬Ù†ÙˆØ¨ Ø¯Ø§Ø±ÙÙˆØ±",
    "ØºØ±Ø¨ Ø¯Ø§Ø±ÙÙˆØ±","ÙˆØ³Ø· Ø¯Ø§Ø±ÙÙˆØ±","Ø´Ø±Ù‚ Ø¯Ø§Ø±ÙÙˆØ±"
  ],
  "Ù…ØµØ±": [
    "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©","Ø§Ù„Ø¬ÙŠØ²Ø©","Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©","Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©",
    "Ø§Ù„Ø´Ø±Ù‚ÙŠØ©","Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©","Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©","Ø§Ù„ØºØ±Ø¨ÙŠØ©",
    "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®","Ø§Ù„Ø¨Ø­ÙŠØ±Ø©","Ø§Ù„ÙÙŠÙˆÙ…","Ø¨Ù†ÙŠ Ø³ÙˆÙŠÙ",
    "Ø§Ù„Ù…Ù†ÙŠØ§","Ø£Ø³ÙŠÙˆØ·","Ø³ÙˆÙ‡Ø§Ø¬","Ù‚Ù†Ø§","Ø§Ù„Ø£Ù‚ØµØ±",
    "Ø£Ø³ÙˆØ§Ù†","Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±","Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯",
    "Ù…Ø·Ø±ÙˆØ­","Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡","Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡","Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©","Ø§Ù„Ø³ÙˆÙŠØ³","Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯"
  ]
};

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¯ÙˆÙ„Ø© */
const stateSelect = document.getElementById("stateFilter");
(statesByCountry[country] || []).forEach(s=>{
  const opt = document.createElement("option");
  opt.value = s;
  opt.textContent = s;
  stateSelect.appendChild(opt);
});

/* Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª */
let allProducts = [];
let currentCategory = "";
let currentState = "";

/* ØªØºÙŠÙŠØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© */
stateSelect.onchange = ()=>{
  currentState = stateSelect.value;
  showProducts();
};

/* Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
onSnapshot(collection(db,"products"), snap=>{
  allProducts = snap.docs.map(d=>d.data());
  showProducts();
});

/* Ø§Ø®ØªÙŠØ§Ø± ØªØµÙ†ÙŠÙ */
window.selectCategory = cat=>{
  currentCategory = cat;
  localStorage.setItem("addCategory", cat);
  document.getElementById("addBtn").style.display = "inline-block";
  showProducts();
};

/* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
function showProducts(){
  const box = document.getElementById("products");
  box.innerHTML = "";

  const filtered = allProducts.filter(p =>
    p.country === country &&
    (!currentCategory || p.category === currentCategory) &&
    (!currentState || p.state === currentState)
  );

  if(!filtered.length){
    box.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>";
    return;
  }

  filtered.forEach(p=>{
    box.innerHTML += `
      <div class="product-card">
        <p>${p.title || ''}</p>
        <b>${p.price || ''}</b>
        <small>${p.state || ''}</small>
      </div>
    `;
  });
}

/* Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ */
window.goAddProduct = ()=>{
  const cat = localStorage.getItem("addCategory");
  if(!cat) return alert("Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙ Ø£ÙˆÙ„Ø§Ù‹");
  location.href = `add-product.html?cat=${encodeURIComponent(cat)}`;
};
</script>

</body>
</html>
