<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Arshi Market</title>
  <style>
    body{ font-family: Arial; margin:0; padding-bottom:70px; background:#f5f5f5; }
    .country-name{ background:#4CAF50; color:#fff; text-align:center; padding:8px; font-weight:bold; cursor:pointer; }
    /* Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª */
    .categories{ display:flex; gap:8px; padding:10px; background:#fff; overflow-x:auto; }
    .categories button{ border:none; background:#eee; padding:8px 14px; border-radius:20px; cursor:pointer; white-space:nowrap; }
    #addBtn{ display:none; background:#4CAF50; color:#fff; }
    /* Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
    .products{ padding:10px; display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .product-card{ background:#fff; padding:6px; border-radius:10px; font-size:13px; }
    .main-img{ width:100%; height:90px; object-fit:cover; border-radius:8px; }
    /* Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
    .user-bar{ display:flex; justify-content:space-between; align-items:center; margin-top:6px; }
    .user{ display:flex; align-items:center; gap:5px; }
    .user img{ width:26px; height:26px; border-radius:50%; }
    .chat-btn{ background:#4CAF50; color:#fff; border:none; padding:4px 8px; border-radius:14px; font-size:12px; cursor:pointer; }
    /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ */
    .bottom-nav{ position:fixed; bottom:0; width:100%; background:#fff; display:flex; justify-content:space-around; padding:10px 0; border-top:1px solid #ccc; }
    .bottom-nav button{ background:none; border:none; font-size:14px; cursor:pointer; }
  </style>
</head>
<body>
  <div class="country-name" id="countryName"></div>
  <!-- Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª -->
  <div class="categories">
    <button onclick="selectCategory('Ø³ÙŠØ§Ø±Ø§Øª')">ğŸš— Ø³ÙŠØ§Ø±Ø§Øª</button>
    <button onclick="selectCategory('Ø¨ÙŠÙˆØª')">ğŸ  Ø¨ÙŠÙˆØª</button>
    <button onclick="selectCategory('Ù‡ÙˆØ§ØªÙ')">ğŸ“± Ù‡ÙˆØ§ØªÙ</button>
    <button onclick="selectCategory('Ø£Ø®Ø±Ù‰')">â• Ø£Ø®Ø±Ù‰</button>
    <button id="addBtn" onclick="goAddProduct()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
  </div>
  <div class="products" id="products"></div>
  <div class="bottom-nav">
    <button onclick="go('products.html')">ğŸ <br>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button onclick="go('chat.html')">ğŸ’¬<br>Ø§Ù„Ø´Ø§Øª</button>
    <button onclick="go('account.html')">ğŸ‘¤<br>Ø§Ù„Ø­Ø³Ø§Ø¨</button>
    <button onclick="go('settings.html')">âš™ï¸<br>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
  </div>

  <!-- ğŸ”¥ Firebase -->
  <script type="module">
    import { initializeApp } from "https:                                                     
    import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD3hAvhSDs-lX7ORCOR0DODT3l_S_gJA2o",
      authDomain: "arshi-market.firebaseapp.com",
      projectId: "arshi-market",
      storageBucket: "arshi-market.firebasestorage.app",
      messagingSenderId: "930764899868",
      appId: "1:930764899868:web:06795817be84f0a68a01d9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const userCountry = localStorage.getItem('country');
    if(!userCountry){
      window.location.href='country.html';
    }
    document.getElementById('countryName').innerText = 'ğŸ“ Ø§Ù„Ø¯ÙˆÙ„Ø©: ' + userCountry;
    document.getElementById('countryName').onclick = ()=>window.location.href='country.html';

    let currentCategory = '';
    let allProducts = [];

    const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
    onSnapshot(q, snapshot=>{
      allProducts = [];
      snapshot.forEach(doc=>{
        allProducts.push({id: doc.id, ...doc.data()});
      });
      if(currentCategory){
        filterAndShow();
      }
    });

    window.selectCategory = function (cat){
      currentCategory = cat;
      document.getElementById('addBtn').style.display='inline-block';
      filterAndShow();
    };

    function filterAndShow(){
      const filtered = allProducts.filter(p => p.country === userCountry && p.category === currentCategory );
      displayProducts(filtered);
    }

    function displayProducts(list){
      const div = document.getElementById('products');
      div.innerHTML = list.length ? '' : '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>';
      list.forEach(p=>{
        div.innerHTML += `
          <div class="product-card" onclick="go('product.html?id=${p.id}')">
            <img class="main-img" src="${p.images?.[0] || ''}">
            <p>${p.title || p.desc}</p>
            <b>${p.price}</b>
            <div class="user-bar">
              <div class="user">
                <img src="${p.userImg || 'https:                      
                ${p.userName || ''}
              </div>
              <button class="chat-btn" onclick="go('chat.html')">Ù…Ø±Ø§Ø³Ù„Ø©</button>
            </div>
          </div>
        `;
      });
    }

    window.goAddProduct = function (){
      window.location.href='add-product.html?cat='+currentCategory;
    }
    window.go = function (p){
      window.location.href=p;
    }
  </script>
</body>
</html>
