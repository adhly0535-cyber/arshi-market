<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>إضافة منتج</title>
<style>
body{font-family:Arial;direction:rtl;padding:20px}
input,button{width:100%;margin:8px 0;padding:10px}
button{background:#28a745;color:#fff;border:none;font-size:16px;cursor:pointer}
</style>
</head>

<body>

<h2>إضافة منتج</h2>

<form id="productForm">
  <input id="title" placeholder="العنوان">
  <input id="price" type="number" placeholder="السعر">
  <input id="stateInput" placeholder="الولاية / المنطقة">
  <input id="desc" placeholder="الوصف">
  <button type="submit">نشر</button>
</form>

<script type="module">
/* اختبار سريع */
alert("الزر يعمل");

/* Firebase */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "PUT_YOUR_KEY",
  authDomain: "PUT_YOUR_DOMAIN",
  projectId: "PUT_YOUR_ID",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;
onAuthStateChanged(auth, user => currentUser = user);

document.getElementById("productForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  if(!currentUser){
    alert("سجّل دخول أولاً");
    return;
  }

  const title = document.getElementById("title").value;
  const price = document.getElementById("price").value;
  const state = document.getElementById("stateInput").value;
  const desc = document.getElementById("desc").value;

  if(!title || !price || !state || !desc){
    alert("املأ كل الحقول");
    return;
  }

  await addDoc(collection(db,"products"),{
    title, price, state, desc,
    userId: currentUser.uid,
    createdAt: Date.now()
  });

  alert("تم النشر بنجاح");
  e.target.reset();
});
</script>

</body>
</html>
