<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</title>

<!-- Uploadcare -->
<script>
  UPLOADCARE_PUBLIC_KEY = "3ebd7495cde73c075c2e";
</script>
<script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>

<style>
body{
  font-family:Arial;
  background:#f5f5f5;
  padding:10px;
}
input, textarea, button, select{
  width:100%;
  margin:6px 0;
  padding:10px;
  font-size:14px;
}
button{
  background:#4CAF50;
  color:#fff;
  border:none;
  border-radius:6px;
}
</style>
</head>

<body>

<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>

<form id="productForm">

  <!-- Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬ -->
  <select id="typeSelect" required>
    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</option>
    <option value="Ø³ÙŠØ§Ø±Ø§Øª">Ø³ÙŠØ§Ø±Ø§Øª</option>
    <option value="Ø¹Ù‚Ø§Ø±Ø§Øª">Ø¹Ù‚Ø§Ø±Ø§Øª</option>
    <option value="ÙˆØ¸Ø§Ø¦Ù">ÙˆØ¸Ø§Ø¦Ù</option>
    <option value="Ù‡ÙˆØ§ØªÙ">Ù‡ÙˆØ§ØªÙ</option>
    <option value="Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª">Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª</option>
  </select>

  <!-- Ø§Ù„ÙˆÙ„Ø§ÙŠØ© -->
  <select id="city" required>
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
    <option value="Ø§Ù„Ø®Ø±Ø·ÙˆÙ…">Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</option>
    <option value="Ø£Ù… Ø¯Ø±Ù…Ø§Ù†">Ø£Ù… Ø¯Ø±Ù…Ø§Ù†</option>
    <option value="Ø¨Ø­Ø±ÙŠ">Ø¨Ø­Ø±ÙŠ</option>
    <option value="Ù…Ø¯Ù†ÙŠ">Ù…Ø¯Ù†ÙŠ</option>
    <option value="ÙƒØ³Ù„Ø§">ÙƒØ³Ù„Ø§</option>
  </select>

  <input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" required>
  <input id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±" required>

  <select id="stateInput" required>
    <option value="">Ø§Ù„Ø­Ø§Ù„Ø©</option>
    <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
    <option value="Ù…Ø³ØªØ¹Ù…Ù„">Ù…Ø³ØªØ¹Ù…Ù„</option>
  </select>

  <!-- Ø§Ù„ØµÙˆØ± (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 3) -->
  <input
    type="hidden"
    role="uploadcare-uploader"
    data-multiple="true"
    data-max-files="3"
    data-clearable="true"
    id="imagesInput"
  />

  <!-- Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ØªØºÙŠØ±Ø© -->
  <div id="extraFields"></div>

  <textarea id="desc" placeholder="Ø§Ù„ÙˆØµÙ" required></textarea>

  <button type="submit">ğŸ“¤ Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
</form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyD3hAvhSDs-lX7ORCOR0DODT3l_S_gJA2o",
  authDomain: "arshi-market.firebaseapp.com",
  projectId: "arshi-market",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

/* Ø¹Ù†Ø§ØµØ± */
const form = document.getElementById("productForm");
const imagesInput = document.getElementById("imagesInput");
const typeSelect = document.getElementById("typeSelect");
const extra = document.getElementById("extraFields");

/* Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ */
typeSelect.addEventListener("change", () => {
  extra.innerHTML = "";

  if(typeSelect.value === "Ø³ÙŠØ§Ø±Ø§Øª"){
    extra.innerHTML = `
      <input id="model" placeholder="Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„">
      <input id="year" placeholder="Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹">
    `;
  }

  if(typeSelect.value === "Ø¹Ù‚Ø§Ø±Ø§Øª"){
    extra.innerHTML = `
      <input id="rooms" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù">
      <input id="area" placeholder="Ø§Ù„Ù…Ø³Ø§Ø­Ø©">
    `;
  }

  if(typeSelect.value === "ÙˆØ¸Ø§Ø¦Ù"){
    extra.innerHTML = `
      <input id="jobType" placeholder="Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©">
      <input id="salary" placeholder="Ø§Ù„Ø±Ø§ØªØ¨">
    `;
  }

  if(typeSelect.value === "Ù‡ÙˆØ§ØªÙ" || typeSelect.value === "Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª"){
    extra.innerHTML = `
      <input id="brand" placeholder="Ø§Ù„Ø´Ø±ÙƒØ©">
      <input id="storage" placeholder="Ø§Ù„Ù…Ø³Ø§Ø­Ø©">
    `;
  }
});

/* Ø§Ù„Ù†Ø´Ø± (Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯ â€“ Ø£ÙŠ Ù…Ø³ØªØ®Ø¯Ù…) */
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!imagesInput.value) {
    alert("ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
    return;
  }

  const user = auth.currentUser;

  const imageUrls = imagesInput.value
    .split(",")
    .map(uuid => `https://ucarecdn.com/${uuid}/`);

  await addDoc(collection(db, "products"), {
    title: title.value,
    price: price.value,
    desc: desc.value,
    state: stateInput.value,
    type: typeSelect.value,
    city: city.value,

    model: document.getElementById("model")?.value || "",
    year: document.getElementById("year")?.value || "",
    rooms: document.getElementById("rooms")?.value || "",
    area: document.getElementById("area")?.value || "",
    jobType: document.getElementById("jobType")?.value || "",
    salary: document.getElementById("salary")?.value || "",
    brand: document.getElementById("brand")?.value || "",
    storage: document.getElementById("storage")?.value || "",

    images: imageUrls,
    userId: user ? user.uid : "guest",
    createdAt: serverTimestamp()
  });

  alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬");
  form.reset();
  extra.innerHTML = "";
});
</script>

</body>
  </html>
