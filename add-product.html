<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</title>

<style>
body{
  font-family: Arial;
  background:#f5f5f5;
  padding:20px;
}

input, select, button{
  width:100%;
  padding:10px;
  margin:8px 0;
  font-size:16px;
}

.section{
  display:none;
  background:#fff;
  padding:10px;
  border-radius:6px;
}

button{
  background:#4CAF50;
  color:#fff;
  border:none;
  cursor:pointer;
}
</style>
</head>

<body>

<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>

<form id="productForm">

  <input id="name" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required>
  <input id="price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" min="1" required>

  <select id="category" required>
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
    <option value="house">Ù…Ù†Ø²Ù„</option>
    <option value="car">Ø³ÙŠØ§Ø±Ø©</option>
    <option value="phone">Ù‡Ø§ØªÙ</option>
  </select>

  <!-- ğŸ  Ù…Ù†Ø²Ù„ -->
  <div id="houseFields" class="section">
    <input id="rooms" type="number" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù" min="1">
    <input id="area" type="number" placeholder="Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)" min="1">
  </div>

  <!-- ğŸš— Ø³ÙŠØ§Ø±Ø© -->
  <div id="carFields" class="section">
    <input id="model" type="text" placeholder="Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„">
    <input id="year" type="number" placeholder="Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹" min="1980">
  </div>

  <!-- ğŸ“± Ù‡Ø§ØªÙ -->
  <div id="phoneFields" class="section">
    <input id="brand" type="text" placeholder="Ø§Ù„Ø´Ø±ÙƒØ©">
    <input id="storage" type="number" placeholder="Ø§Ù„Ø°Ø§ÙƒØ±Ø© (GB)" min="1">
  </div>

  <button type="submit">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>

</form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT_ID",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser = null;

onAuthStateChanged(auth, user=>{
  if(user){
    currentUser = user;
  }else{
    window.location.href = "index.html";
  }
});

const category = document.getElementById("category");
const house = document.getElementById("houseFields");
const car = document.getElementById("carFields");
const phone = document.getElementById("phoneFields");

category.addEventListener("change", ()=>{
  house.style.display = "none";
  car.style.display = "none";
  phone.style.display = "none";

  if(category.value === "house") house.style.display="block";
  if(category.value === "car") car.style.display="block";
  if(category.value === "phone") phone.style.display="block";
});

document.getElementById("productForm").addEventListener("submit", async (e)=>{
  e.preventDefault();

  if(!currentUser){
    alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    return;
  }

  const name = document.getElementById("name").value.trim();
  const price = Number(document.getElementById("price").value);
  const cat = category.value;

  if(!name || price <= 0 || !cat){
    alert("Ø§Ù„Ù‚ÙŠÙ… ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    return;
  }

  let extra = {};

  if(cat === "house"){
    const rooms = Number(document.getElementById("rooms").value);
    const area = Number(document.getElementById("area").value);
    if(rooms<=0 || area<=0) return alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    extra = { rooms, area };
  }

  if(cat === "car"){
    const model = document.getElementById("model").value.trim();
    const year = Number(document.getElementById("year").value);
    if(!model || year<=0) return alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    extra = { model, year };
  }

  if(cat === "phone"){
    const brand = document.getElementById("brand").value.trim();
    const storage = Number(document.getElementById("storage").value);
    if(!brand || storage<=0) return alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    extra = { brand, storage };
  }

  await addDoc(collection(db,"products"),{
    name,
    price,
    category: cat,
    country: localStorage.getItem("country") || "",
    ...extra,
    userId: currentUser.uid,
    createdAt: serverTimestamp()
  });

  alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­");
  window.location.href = "products.html";
});
</script>

</body>
</html>
