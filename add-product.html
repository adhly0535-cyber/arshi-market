<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</title>

<style>
body{
  font-family:Arial;
  background:#f5f5f5;
  margin:0;
  padding:10px;
}
h2{text-align:center}
form{
  background:#fff;
  padding:15px;
  border-radius:10px;
}
input, textarea, button, select{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:8px;
  border:1px solid #ccc;
}
.hidden{display:none}
button{
  background:#4CAF50;
  color:#fff;
  border:none;
  font-size:16px;
}
small{color:#666}
</style>
</head>

<body>

<h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h2>

<form id="productForm" novalidate>

  <input id="title" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ / Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" required>
  <input id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±" required>

  <input type="file" id="imagesInput" accept="image/*" multiple>
  <small>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø­ØªÙ‰ 5 ØµÙˆØ± ÙÙ‚Ø·</small>

  <input id="stateInput" placeholder="Ø§Ù„ÙˆÙ„Ø§ÙŠØ© / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©" required>

  <select id="categorySelect" required>
    <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</option>
    <option value="Ø¨ÙŠÙˆØª">ğŸ  Ù…Ù†Ø²Ù„ / Ø¨ÙŠØª</option>
    <option value="Ø³ÙŠØ§Ø±Ø§Øª">ğŸš— Ø³ÙŠØ§Ø±Ø©</option>
    <option value="Ù‡ÙˆØ§ØªÙ">ğŸ“± Ù‡Ø§ØªÙ</option>
  </select>

  <div id="normalFields">
    <select id="condition">
      <option value="">Ø§Ù„Ø­Ø§Ù„Ø©</option>
      <option>Ø¬Ø¯ÙŠØ¯</option>
      <option>Ù…Ø³ØªØ¹Ù…Ù„</option>
    </select>
    <input id="defects" placeholder="Ø§Ù„Ø¹ÙŠÙˆØ¨ (Ø¥Ù† ÙˆØ¬Ø¯Øª)">
  </div>

  <div id="houseFields" class="hidden">
    <input id="area" placeholder="Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„Ø­ÙŠ">
    <input id="landType" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ø£Ø±Ø¶">
    <select id="built">
      <option>Ù…Ø¨Ù†ÙŠ Ø¬Ø§Ù‡Ø²</option>
      <option>Ø£Ø±Ø¶ ÙÙ‚Ø·</option>
    </select>
    <select id="deal">
      <option>Ø¨ÙŠØ¹</option>
      <option>Ø¥ÙŠØ¬Ø§Ø±</option>
    </select>
  </div>

  <textarea id="desc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬" required></textarea>

  <button type="submit">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
</form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyD3hAvhSDs-lX7ORCOR0DODT3l_S_gJA2o",
  authDomain: "arshi-market.firebaseapp.com",
  projectId: "arshi-market",
  storageBucket: "arshi-market.appspot.com",
  messagingSenderId: "930764899868",
  appId: "1:930764899868:web:06795817be84f0a68a01d9"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

let currentUser = null;
onAuthStateChanged(auth, (user)=> currentUser = user);

/* ===== Ø§Ù„Ø¹Ù†Ø§ØµØ± ===== */
const productForm = document.getElementById("productForm");
const title = document.getElementById("title");
const price = document.getElementById("price");
const desc = document.getElementById("desc");
const stateInput = document.getElementById("stateInput");
const imagesInput = document.getElementById("imagesInput");
const categorySelect = document.getElementById("categorySelect");

const normalFields = document.getElementById("normalFields");
const houseFields = document.getElementById("houseFields");

/* ===== Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ ===== */
categorySelect.addEventListener("change", ()=>{
  if(categorySelect.value === "Ø¨ÙŠÙˆØª"){
    houseFields.classList.remove("hidden");
    normalFields.classList.add("hidden");
  }else{
    houseFields.classList.add("hidden");
    normalFields.classList.remove("hidden");
  }
});

/* ===== Ø§Ù„Ù†Ø´Ø± ===== */
productForm.addEventListener("submit", async (e)=>{
  e.preventDefault();

  if(!currentUser){
    alert("âŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  if(!title.value || !price.value || !stateInput.value || !desc.value || !categorySelect.value){
    alert("âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
    return;
  }

  const country = localStorage.getItem("country");
  if(!country){
    alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆÙ„Ø©");
    return;
  }

  let imageUrls = [];
  for(const file of imagesInput.files){
    const imgRef = ref(storage, `products/${currentUser.uid}/${Date.now()}_${file.name}`);
    await uploadBytes(imgRef, file);
    imageUrls.push(await getDownloadURL(imgRef));
  }

  await addDoc(collection(db,"products"), {
    title: title.value,
    price: price.value,
    desc: desc.value,
    country,
    state: stateInput.value,
    category: categorySelect.value,
    userId: currentUser.uid,
    createdAt: serverTimestamp(),
    images: imageUrls
  });

  alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­");
  window.location.href = "products.html";
});
</script>

</body>
</html>
  
