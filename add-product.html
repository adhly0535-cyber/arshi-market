<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>إضافة منتج</title>
<style>
body{font-family:Arial;direction:rtl;padding:20px}
input,button{width:100%;margin:8px 0;padding:10px}
button{background:#28a745;color:#fff;border:none;font-size:16px;cursor:pointer}
</style>
</head>

<body>

<h2>إضافة منتج</h2>

<form id="productForm">
  <input id="title" placeholder="العنوان">
  <input id="price" type="number" placeholder="السعر">
  <input id="stateInput" placeholder="الولاية / المنطقة">
  <input id="desc" placeholder="الوصف">
  <button type="submit">نشر</button>
</form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "PUT_YOUR_KEY",
  authDomain: "PUT_YOUR_DOMAIN",
  projectId: "PUT_YOUR_ID",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

document.getElementById("productForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const user = auth.currentUser; // ✅ الحل هنا

  if (!user) {
    alert("يجب تسجيل الدخول أولاً");
    return;
  }

  const title = document.getElementById("title").value.trim();
  const price = document.getElementById("price").value.trim();
  const state = document.getElementById("stateInput").value.trim();
  const desc = document.getElementById("desc").value.trim();
  const country = localStorage.getItem("country") || "";

  if (!title || !price || !state || !desc) {
    alert("املأ كل الحقول");
    return;
  }

  try {
    await addDoc(collection(db, "products"), {
      title,
      price: Number(price),
      state,
      desc,
      country,
      userId: user.uid,
      createdAt: Date.now()
    });

    alert("✅ تم نشر المنتج بنجاح");
    window.location.href = "products.html";

  } catch (err) {
    alert("❌ فشل النشر");
    console.error(err);
  }
});
</script>

</body>
</html>
