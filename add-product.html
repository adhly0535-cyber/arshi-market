<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</title>

<script>
UPLOADCARE_PUBLIC_KEY = "3ebd7495cde73c075c2e";
</script>
<script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>

<style>
body{
  font-family:Arial;
  background:#f5f5f5;
  padding:10px;
}
input, textarea, button, select{
  width:100%;
  margin:6px 0;
  padding:10px;
  font-size:14px;
}
button{
  background:#4CAF50;
  color:#fff;
  border:none;
  border-radius:6px;
}
</style>
</head>

<body>

<h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>

<form id="productForm">

<select id="typeSelect" required>
  <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</option>
  <option value="Ø³ÙŠØ§Ø±Ø§Øª">Ø³ÙŠØ§Ø±Ø§Øª</option>
  <option value="Ø¹Ù‚Ø§Ø±Ø§Øª">Ø¹Ù‚Ø§Ø±Ø§Øª</option>
  <option value="ÙˆØ¸Ø§Ø¦Ù">ÙˆØ¸Ø§Ø¦Ù</option>
  <option value="Ù‡ÙˆØ§ØªÙ">Ù‡ÙˆØ§ØªÙ</option>
  <option value="Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª">Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª</option>
</select>

<select id="city" required>
  <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
</select>

<input id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" required>
<input id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±" required>

<select id="stateInput" required>
  <option value="">Ø§Ù„Ø­Ø§Ù„Ø©</option>
  <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯</option>
  <option value="Ù…Ø³ØªØ¹Ù…Ù„">Ù…Ø³ØªØ¹Ù…Ù„</option>
</select>

<input id="whatsapp" placeholder="Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ (Ù…Ø«Ø§Ù„: 201234567890)" required>

<input type="hidden"
  role="uploadcare-uploader"
  data-multiple="true"
  data-max-files="3"
  data-clearable="true"
  id="imagesInput"
/>

<div id="extraFields"></div>

<textarea id="desc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬" required></textarea>

<button type="submit">ğŸ“¤ Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
</form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD3hAvhSDs-lX7ORCOR0DODT3l_S_gJA2o",
  authDomain: "arshi-market.firebaseapp.com",
  projectId: "arshi-market",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const statesByCountry = {
  "Ø§Ù„Ø³ÙˆØ¯Ø§Ù†":[
    "Ø§Ù„Ø®Ø±Ø·ÙˆÙ…","Ø§Ù„Ø¬Ø²ÙŠØ±Ø©","Ù†Ù‡Ø± Ø§Ù„Ù†ÙŠÙ„","Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø­Ù…Ø±","ÙƒØ³Ù„Ø§","Ø§Ù„Ù‚Ø¶Ø§Ø±Ù",
    "Ø³Ù†Ø§Ø±","Ø§Ù„Ù†ÙŠÙ„ Ø§Ù„Ø£Ø¨ÙŠØ¶","Ø´Ù…Ø§Ù„ ÙƒØ±Ø¯ÙØ§Ù†","Ø¬Ù†ÙˆØ¨ ÙƒØ±Ø¯ÙØ§Ù†","ØºØ±Ø¨ ÙƒØ±Ø¯ÙØ§Ù†",
    "Ø´Ù…Ø§Ù„ Ø¯Ø§Ø±ÙÙˆØ±","Ø¬Ù†ÙˆØ¨ Ø¯Ø§Ø±ÙÙˆØ±","ØºØ±Ø¨ Ø¯Ø§Ø±ÙÙˆØ±","ÙˆØ³Ø· Ø¯Ø§Ø±ÙÙˆØ±","Ø´Ø±Ù‚ Ø¯Ø§Ø±ÙÙˆØ±",
    "Ø§Ù„Ø´Ù…Ø§Ù„ÙŠØ©","Ø§Ù„Ù†ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ù‚"
  ],
  "Ù…ØµØ±":[
    "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©","Ø§Ù„Ø¬ÙŠØ²Ø©","Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©","Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©","Ø§Ù„Ø´Ø±Ù‚ÙŠØ©","Ø§Ù„Ù‚Ù„ÙŠÙˆØ¨ÙŠØ©",
    "ÙƒÙØ± Ø§Ù„Ø´ÙŠØ®","Ø§Ù„ØºØ±Ø¨ÙŠØ©","Ø§Ù„Ù…Ù†ÙˆÙÙŠØ©","Ø§Ù„Ø¨Ø­ÙŠØ±Ø©","Ø¯Ù…ÙŠØ§Ø·","Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯",
    "Ø§Ù„Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ÙŠØ©","Ø§Ù„Ø³ÙˆÙŠØ³","Ø§Ù„ÙÙŠÙˆÙ…","Ø§Ù„Ù…Ù†ÙŠØ§","Ø£Ø³ÙŠÙˆØ·","Ø³ÙˆÙ‡Ø§Ø¬",
    "Ù‚Ù†Ø§","Ø§Ù„Ø£Ù‚ØµØ±","Ø£Ø³ÙˆØ§Ù†","Ù…Ø·Ø±ÙˆØ­","Ø§Ù„ÙˆØ§Ø¯ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯","Ø´Ù…Ø§Ù„ Ø³ÙŠÙ†Ø§Ø¡","Ø¬Ù†ÙˆØ¨ Ø³ÙŠÙ†Ø§Ø¡"
  ]
};

const citySelect = document.getElementById("city");
let country = "";

onAuthStateChanged(auth, async(user)=>{
  if(!user){
    location.href="index.html";
    return;
  }

  const snap = await getDoc(doc(db,"users",user.uid));
  if(snap.exists()){
    country = snap.data().country;

    citySelect.innerHTML = `<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© / Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>`;

    (statesByCountry[country] || []).forEach(c=>{
      const o = document.createElement("option");
      o.value = c;
      o.textContent = c;
      citySelect.appendChild(o);
    });
  }
});

/* Ø¨Ù‚ÙŠØ© Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± */

const typeSelect = document.getElementById("typeSelect");
const extra = document.getElementById("extraFields");

typeSelect.addEventListener("change", ()=>{
  extra.innerHTML = "";

  if(typeSelect.value === "Ø³ÙŠØ§Ø±Ø§Øª"){
    extra.innerHTML = `
      <input id="model" placeholder="Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„">
      <input id="year" placeholder="Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹">
      <input id="km" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª">
      <input id="gear" placeholder="Ù†Ø§Ù‚Ù„ Ø§Ù„Ø­Ø±ÙƒØ©">
      <input id="fuel" placeholder="Ù†ÙˆØ¹ Ø§Ù„ÙˆÙ‚ÙˆØ¯">
    `;
  }

  if(typeSelect.value === "Ø¹Ù‚Ø§Ø±Ø§Øª"){
    extra.innerHTML = `
      <input id="rooms" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„ØºØ±Ù">
      <input id="bathrooms" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù…Ø§Ù…Ø§Øª">
      <input id="area" placeholder="Ø§Ù„Ù…Ø³Ø§Ø­Ø©">
      <input id="floor" placeholder="Ø§Ù„Ø·Ø§Ø¨Ù‚">
      <input id="furnished" placeholder="Ù…ÙØ±ÙˆØ´ / Ù„Ø§">
    `;
  }

  if(typeSelect.value === "ÙˆØ¸Ø§Ø¦Ù"){
    extra.innerHTML = `
      <input id="jobType" placeholder="Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©">
      <input id="experience" placeholder="Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¨Ø±Ø©">
      <input id="salary" placeholder="Ø§Ù„Ø±Ø§ØªØ¨">
      <input id="workPlace" placeholder="Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„">
    `;
  }

  if(typeSelect.value === "Ù‡ÙˆØ§ØªÙ" || typeSelect.value === "Ù„Ø§Ø¨ØªÙˆØ¨Ø§Øª"){
    extra.innerHTML = `
      <input id="brand" placeholder="Ø§Ù„Ø´Ø±ÙƒØ©">
      <input id="storage" placeholder="Ø§Ù„ØªØ®Ø²ÙŠÙ†">
      <input id="ram" placeholder="Ø§Ù„Ø±Ø§Ù…">
      <input id="extraTech" placeholder="Ù…ÙˆØ§ØµÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
    `;
  }
});

const form = document.getElementById("productForm");
const imagesInput = document.getElementById("imagesInput");
const whatsappInput = document.getElementById("whatsapp");

form.addEventListener("submit", async (e)=>{
  e.preventDefault();

  if(!imagesInput.value){
    alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
    return;
  }

  const user = auth.currentUser;

  const imageUrls = imagesInput.value
    .split(",")
    .map(id=>`https://ucarecdn.com/${id}/`);

  await addDoc(collection(db,"products"),{
    title: title.value,
    price: price.value,
    desc: desc.value,
    state: stateInput.value,
    city: city.value,
    category: typeSelect.value,
    country: country,
    whatsapp: whatsappInput.value,

    model: model?.value || "",
    year: year?.value || "",
    km: km?.value || "",
    gear: gear?.value || "",
    fuel: fuel?.value || "",

    rooms: rooms?.value || "",
    bathrooms: bathrooms?.value || "",
    area: area?.value || "",
    floor: floor?.value || "",
    furnished: furnished?.value || "",

    jobType: jobType?.value || "",
    experience: experience?.value || "",
    salary: salary?.value || "",
    workPlace: workPlace?.value || "",

    brand: brand?.value || "",
    storage: storage?.value || "",
    ram: ram?.value || "",
    extraTech: extraTech?.value || "",

    images: imageUrls,
    userId: user.uid,
    createdAt: serverTimestamp()
  });

  alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬");
  form.reset();
  extra.innerHTML="";
});
</script>

</body>
  </html>
